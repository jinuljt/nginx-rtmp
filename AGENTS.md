# Repository Guidelines

## Project Structure & Module Organization
- `Dockerfile` builds the Alpine 3.20 image, compiles nginx 1.26 with `nginx-rtmp-module`, and layers the Flask manager; touch this file whenever dependency versions or runtime layout change.
- `nginx.conf` defines the RTMP application and HTTP status site; it now `include`s `/etc/nginx/conf.d/rtmp_pushes.conf` which is generated by the manager.
- `manager/` hosts the Flask UI (`app.py`, `templates/`) and is copied to `/opt/rtmp-manager`; keep web assets small and dependency-free.
- `nginx.d/rtmp_pushes.conf` is a placeholder shipped in the image—avoid manual edits, rely on the manager instead.
- `README.md` remains the client-facing guide (Chinese-first); mirror any workflow changes here and append English notes when useful for global users.
- `docs/requirements.md` tracks product requirements; update it whenever behaviour or scope changes.

## Build, Test, and Development Commands
- `docker build -t nginx-rtmp:dev .` rebuilds the image locally with the latest sources; rerun whenever the Dockerfile or dependencies change.
- `docker run --rm -p 1935:1935 -p 8080:8080 -p 5000:5000 nginx-rtmp:dev` launches the stack for manual verification; drop `-p 8080:8080` or `-p 5000:5000` to disable the stat page or manager respectively.
- `docker exec nginx-rtmp nginx -t` validates `nginx.conf` syntax; expect `syntax is ok`.
- `curl -s http://localhost:5000/api/sources` quickly confirms the Flask manager is reachable and returning the current push list.

## Coding Style & Naming Conventions
- Keep Dockerfile instructions uppercase with one logical change per layer to minimise cache busts; pin explicit versions (e.g. `ARG NGINX_VERSION=1.26.2`).
- Use four-space indentation in `nginx.conf`, align directives vertically, and favour lowercase identifiers (`app`, `live`) to match current naming.
- In Flask views, keep logic inside helper functions and bubble user-facing messages via `flash`; avoid external dependencies beyond Flask + Gunicorn.
- Python依赖通过 `/opt/rtmp-manager/.venv` 虚拟环境安装；别在系统 Python 中追加包。
- Comment non-obvious RTMP pushes or auth blocks so downstream operators understand the streaming pipeline.

## Testing Guidelines
- There is no automated test suite; rely on `nginx -t`, container start logs, and manual streaming checks.
- Confirm `http://localhost:8080/stat` loads and shows active streams after pushing test traffic（如 OBS 使用 `rtmp://localhost:1935/app/stream_key`）.
- Exercise the manager by adding/removing push URLs through `http://localhost:5000/`; inspect `/etc/nginx/conf.d/rtmp_pushes.conf` to ensure updates.
- Capture the commands and observations in the PR description so reviewers can reproduce.

## Commit & Pull Request Guidelines
- Existing commits are concise and action-oriented; follow that style and include scope prefixes when helpful (e.g. `build: refresh base image`, `config: tighten rtmp auth`).
- For each PR, describe the motivation, list configuration changes, and note how you validated streaming paths; attach screenshots of the stat page if UI output changed.
- Link to related issues or deployment notes and request review from maintainers responsible for Docker image releases.

## Configuration Tips
- Place environment-specific overrides in a separate `.conf` file and mount it with `-v custom.conf:/etc/nginx/conf.d/custom.conf` to keep the base config generic.
- When modifying RTMP applications, keep keys stable across environments to avoid breaking existing client presets; document any required DNS or firewall updates.
